<div *ngIf="game" class="container py-3 game-detail">

  <!-- =====================[ ‡∏Å‡∏≤‡∏£‡πå‡∏î: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏° ]===================== -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center gap-2">
        <h3 class="h5 mb-0">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°</h3>
        <span class="badge" [class.bg-success]="game.active" [class.bg-secondary]="!game.active">
          {{ game.active ? 'Active' : 'Inactive' }}
        </span>
      </div>
      <button type="button" class="btn btn-sm btn-outline-warning" (click)="toggleGameActive()">
        {{ game.active ? '‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏Å‡∏°' : '‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏Å‡∏°' }}
      </button>
    </div>

    <div class="card-body">
      <form *ngIf="gameForm" [formGroup]="gameForm" (ngSubmit)="updateGame()">
        <div class="row g-3">
          <div class="col-lg-8">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏° <span class="text-danger">*</span></label>
                <input type="text" class="form-control" formControlName="name" placeholder="‡πÄ‡∏ä‡πà‡∏ô PUBG">
              </div>
              <div class="col-md-6">
                <label class="form-label">Slug</label>
                <input type="text" class="form-control" formControlName="slug" placeholder="‡πÄ‡∏ä‡πà‡∏ô pubg">
              </div>
              <div class="col-12">
                <label class="form-label">Cover URL</label>
                <input type="url" class="form-control" formControlName="coverurl" placeholder="http://...">
              </div>
              <div class="col-12">
                <label class="form-label">Description</label>
                <textarea class="form-control" formControlName="description" rows="3"></textarea>
              </div>
            </div>
          </div>

          <div class="col-lg-4">
            <label class="form-label">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏õ‡∏Å</label>
            <div class="ratio ratio-4x3 border rounded overflow-hidden bg-light d-flex align-items-center justify-content-center">
              <img *ngIf="gameForm.value.coverurl"
                   [src]="gameForm.value.coverurl"
                   alt="cover preview"
                   class="w-100 h-100 object-fit-cover"
                   (error)="onImgError($event)">
              <div *ngIf="!gameForm.value.coverurl" class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏†‡∏≤‡∏û‡∏õ‡∏Å</div>
            </div>
          </div>
        </div>

        <div class="mt-3 d-flex gap-2">
          <button type="submit" class="btn btn-success" [disabled]="gameForm.invalid">
            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
          </button>
          <a class="btn btn-outline-secondary" [routerLink]="['/addgame']">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</a>
        </div>
      </form>
    </div>
  </div>

  <!-- =====================[ ‡∏Å‡∏≤‡∏£‡πå‡∏î: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏´‡∏°‡πà ]===================== -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header">
      <h3 class="h6 mb-0">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>
    </div>
    <div class="card-body">
      <form *ngIf="priceForm" [formGroup]="priceForm" (ngSubmit)="addPrice()">
        <div class="row g-3 align-items-end">
          <div class="col-md-5">
            <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à <span class="text-danger">*</span></label>
            <input type="text" formControlName="title" class="form-control" placeholder="‡πÄ‡∏ä‡πà‡∏ô 100 UC">
          </div>
          <div class="col-md-3">
            <label class="form-label">‡∏£‡∏≤‡∏Ñ‡∏≤ (THB) <span class="text-danger">*</span></label>
            <input type="number" formControlName="priceThb" class="form-control" placeholder="‡πÄ‡∏ä‡πà‡∏ô 150">
          </div>
          <div class="col-md-3">
            <label class="form-label">Icon URL</label>
            <input type="text" formControlName="iconurl" class="form-control" placeholder="http://.../icon.png">
          </div>
          <div class="col-md-1 d-grid">
            <button type="submit" class="btn btn-primary" [disabled]="priceForm.invalid">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
          </div>
        </div>
        <div class="form-text mt-2">
          ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î <strong>Rank</strong> ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÅ‡∏•‡∏∞‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô ‚Äú‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡πÄ‡∏Å‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‚Äù
        </div>
      </form>
    </div>
  </div>

  <!-- =====================[ ‡∏Å‡∏≤‡∏£‡πå‡∏î: ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤ ]===================== -->
  <div class="card shadow-sm">
    <div class="card-header d-flex align-items-center justify-content-between">
      <h3 class="h6 mb-0">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏Ñ‡∏≤</h3>
      <span class="text-muted">{{ prices.length || 0 }} ‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à</span>
    </div>

    <div class="table-responsive">
      <table class="table table-striped table-bordered align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th class="text-center" style="width:80px;">Rank</th>
            <th>‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à</th>
            <th class="text-end" style="width:160px;">‡∏£‡∏≤‡∏Ñ‡∏≤ (THB)</th>
            <th class="text-center" style="width:90px;">Icon</th>
            <th class="text-center" style="width:170px;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            <th class="text-center" style="width:200px;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody>

          <!-- ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• -->
          <ng-container *ngFor="let p of prices">
            <tr *ngIf="editingId !== p.id">
              <td class="text-center">{{ p.rank }}</td>
              <td class="text-truncate" style="max-width:360px">{{ p.title }}</td>
              <td class="text-end">{{ p.priceThb | number }}</td>
              <td class="text-center">
                <img *ngIf="p.iconurl"
                     [src]="p.iconurl"
                     width="28" height="28"
                     class="rounded"
                     alt="icon"
                     (error)="onImgError($event)">
              </td>
              <td class="text-center">
                <button type="button" class="btn btn-sm btn-outline-warning" (click)="togglePriceActive(p)">
                  {{ p.active ? '‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' }}
                </button>
              </td>
              <td class="text-center">
                <div class="btn-group btn-group-sm">
                  <button type="button" class="btn btn-outline-secondary" (click)="startEdit(p)">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                  <button type="button" class="btn btn-danger" (click)="deletePrice(p)">üóë ‡∏•‡∏ö</button>
                </div>
              </td>
            </tr>

            <!-- ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏¥‡∏ô‡πÑ‡∏•‡∏ô‡πå -->
            <tr *ngIf="editingId === p.id">
              <td class="text-center">{{ p.rank }}</td>
              <td colspan="5">
                <form *ngIf="editForm" [formGroup]="editForm" (ngSubmit)="saveEdit(p)">
                  <div class="row g-3 align-items-end">
                    <div class="col-md-5">
                      <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à</label>
                      <input type="text" class="form-control" formControlName="title">
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">‡∏£‡∏≤‡∏Ñ‡∏≤ (THB)</label>
                      <input type="number" class="form-control" formControlName="priceThb">
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Icon URL</label>
                      <input type="text" class="form-control" formControlName="iconurl">
                      <div class="mt-2">
                        <img *ngIf="editForm.value.iconurl" [src]="editForm.value.iconurl" width="28" height="28"
                             class="rounded border"
                             (error)="onImgError($event)">
                      </div>
                    </div>
                    <div class="col-md-1 d-grid">
                      <button type="submit" class="btn btn-success btn-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                      <button type="button" class="btn btn-outline-secondary btn-sm mt-1" (click)="cancelEdit()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                  </div>
                </form>
              </td>
            </tr>
          </ng-container>

          <tr *ngIf="!prices.length">
            <td colspan="6" class="text-center text-muted py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏ô‡πÄ‡∏Å‡∏°‡∏ô‡∏µ‡πâ</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>
